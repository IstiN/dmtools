<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspaces - DMTools</title>
    <link rel="icon" href="img/dmtools-icon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styleguide/styleguide.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<!-- Site header -->
<header class="site-header">
    <a href="/" class="site-title">
        <img src="img/dmtools-logo-network-nodes.svg" alt="DMTools Logo" class="logo-light" style="height: 48px;" />
        <img src="img/dmtools-logo-network-nodes-dark.svg" alt="DMTools Logo" class="logo-dark" style="height: 48px; display: none;" />
    </a>
    
    <!-- Search form using styleguide component -->
    <form class="search-form">
        <input type="search" placeholder="Search agents and apps..." aria-label="Search">
        <button type="submit" class="btn">Search</button>
    </form>
    
    <div class="nav-actions">
        <button class="btn btn-icon" id="theme-toggle" title="Toggle theme">
                        <i class="fas fa-moon" id="theme-icon"></i>
                    </button>
        <button id="chat-toggle-btn" class="btn btn-icon" title="Open AI Assistant">
            <i class="fas fa-comments"></i>
        </button>
        <button class="btn btn-login" onclick="handleLoginClick()">
            <i class="fas fa-sign-in-alt"></i>
            Login
        </button>
    </div>
</header>

<!-- App layout with sidebar -->
<div class="app-layout">
    <!-- Sidebar Navigation -->
    <nav class="sidebar-nav app-layout__sidebar">
        <div class="sidebar-nav__content">
            <!-- Main Navigation -->
            <div class="sidebar-nav__section">
                <ul class="sidebar-nav__list">
                    <li class="sidebar-nav__item">
                        <a href="/" class="sidebar-nav__link">
                            <i class="sidebar-nav__icon fas fa-home"></i>
                            <span class="sidebar-nav__text">For You</span>
                        </a>
                    </li>
                    <li class="sidebar-nav__item">
                        <a href="/workspaces.html" class="sidebar-nav__link active" id="workspaces-link">
                            <i class="sidebar-nav__icon fas fa-briefcase"></i>
                            <span class="sidebar-nav__text">Workspaces</span>
                        </a>
                    </li>
                    <li class="sidebar-nav__item">
                        <a href="/agents.html" class="sidebar-nav__link">
                            <i class="sidebar-nav__icon fas fa-robot"></i>
                            <span class="sidebar-nav__text">Agents</span>
                            <span class="sidebar-nav__badge">3</span>
                        </a>
                    </li>
                    <li class="sidebar-nav__item">
                        <a href="/applications.html" class="sidebar-nav__link">
                            <i class="sidebar-nav__icon fas fa-th-large"></i>
                            <span class="sidebar-nav__text">Applications</span>
                        </a>
                    </li>
                </ul>
            </div>


                        </div>
    </nav>

    <!-- Main Content -->
    <main class="app-layout__main">
        <div class="container">
            <!-- Page Header with Workspace Tabs -->
            <div class="section-header" style="margin-bottom: 1rem;">
                <h1 class="section-title">Workspaces</h1>
                <button class="btn btn-primary" id="show-create-form">
                    <i class="fas fa-plus"></i>
                    Create Workspace
                </button>
            </div>

            <!-- Workspace Tabs (shown only when user is authenticated) -->
            <div id="workspace-tabs-container" class="workspace-tabs" style="margin-bottom: 2rem; padding: 0; display: none;">
                <!-- Tabs will be dynamically generated -->
            </div>

            <!-- Unauthorized State -->
            <div id="unauthorized-state" class="workspace-empty-state" style="display: none;">
                <i class="fas fa-lock" style="color: var(--accent-color);"></i>
                <h3>Please log in to access workspaces</h3>
                <p>You need to be authenticated to view and manage your workspaces.</p>
                <button class="btn btn-primary" id="unauthorized-login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>
            </div>

            <!-- Loading State -->
            <div id="loading-state" class="workspace-empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <h3>Loading workspaces...</h3>
                <p>Please wait while we fetch your workspaces.</p>
            </div>

            <!-- Create Workspace Section -->
            <div id="create-workspace-section" class="workspace-form" style="display: none;">
                <h2 class="workspace-form__title">Create New Workspace</h2>
                <form id="create-workspace-form">
                    <div class="form-group">
                        <label for="workspace-name">Workspace Name *</label>
                        <input type="text" id="workspace-name" name="name" placeholder="Enter workspace name" required>
                    </div>
                    <div class="form-group">
                        <label for="workspace-description">Description (optional)</label>
                        <textarea id="workspace-description" name="description" placeholder="Describe your workspace..." rows="3"></textarea>
                    </div>
                    <div class="workspace-form__actions">
                        <button type="button" class="btn btn-tertiary" id="cancel-create">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Workspace</button>
                    </div>
                </form>
            </div>



            <!-- Workspaces List -->
            <div id="workspaces-container" class="workspace-list" style="display: none;">
                <!-- Workspaces will be dynamically loaded here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="workspace-empty-state" style="display: none;">
                <i class="fas fa-briefcase"></i>
                <h3>No workspaces yet</h3>
                <p>Create your first workspace to start organizing your agents and applications.</p>
                <button class="btn btn-primary" id="create-first-workspace">Create Workspace</button>
            </div>

            <!-- Error State -->
            <div id="error-state" class="workspace-empty-state" style="display: none;">
                <i class="fas fa-exclamation-triangle" style="color: var(--danger-color);"></i>
                <h3>Failed to load workspaces</h3>
                <p id="error-message">Please try again later.</p>
                <button class="btn btn-primary" id="retry-load">Try Again</button>
            </div>
        </div> <!-- Close container -->
    </main> <!-- Close app-layout__main -->
</div> <!-- Close app-layout -->

    <!-- Workspace Detail Modal -->
    <div id="workspace-modal" class="login-modal" style="display: none;">
        <div class="login-modal-content" style="max-width: 800px;">
            <button class="login-modal-close" id="close-workspace-modal">
                <i class="fas fa-times"></i>
            </button>
            <div id="workspace-modal-content">
                <!-- Workspace details will be loaded here -->
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/workspace-manager.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Initialize workspace manager when page loads directly
        document.addEventListener('DOMContentLoaded', function() {
            console.log('workspaces.html DOM loaded, checking for workspaceManager');
            // Only create a new instance if not already created by SPA navigation
            if (!window.workspaceManager) {
                console.log('Creating workspaceManager instance for direct page load');
                window.workspaceManager = new WorkspaceManager();
            } else {
                console.log('WorkspaceManager already exists, reinitializing');
                // If it exists but needs to be reinitialized for the workspaces page
                if (window.workspaceManager.isWorkspacePage()) {
                    window.workspaceManager.init();
                }
            }
        });
    </script>
</body>
</html> 