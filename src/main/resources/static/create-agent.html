<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMTools - Create New Agent</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<!-- Site header -->
<header class="site-header">
    <a href="/" class="site-title">
        <img src="img/logo.svg" alt="DMTools Logo">
    </a>
    <div class="nav-actions">
        <a href="settings.html" class="btn-icon">
            <i class="fas fa-cog"></i>
        </a>
        <button id="theme-toggle" class="theme-switch">
            <i class="fas fa-moon"></i>
            <span class="theme-text">Dark mode</span>
        </button>
    </div>
</header>

<div class="container">
    <form id="create-agent-form">
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-robot"></i>
                Agent Configuration
            </h2>
            
            <div class="form-group">
                <label for="agent-label">Agent Label</label>
                <input type="text" id="agent-label" name="label" placeholder="Enter agent name">
            </div>

            <div class="form-group">
                <label for="project-context">Project Context</label>
                <textarea id="project-context" name="projectContext" placeholder="Enter project context"></textarea>
            </div>

            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="is-code-source" name="isCodeAsSource">
                    <label for="is-code-source">Use Code as Source</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="is-confluence-source" name="isConfluenceAsSource">
                    <label for="is-confluence-source">Use Confluence as Source</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="is-tracker-source" name="isTrackerAsSource">
                    <label for="is-tracker-source">Use Tracker as Source</label>
                </div>
            </div>

            <div class="limits-grid">
                <div class="limit-item">
                    <label for="files-limit">Files Limit</label>
                    <input type="number" id="files-limit" name="filesLimit" value="5" min="1">
                </div>
                <div class="limit-item">
                    <label for="files-iterations">Files Iterations</label>
                    <input type="number" id="files-iterations" name="filesIterations" value="1" min="1">
                </div>
                <div class="limit-item">
                    <label for="confluence-limit">Confluence Limit</label>
                    <input type="number" id="confluence-limit" name="confluenceLimit" value="5" min="1">
                </div>
                <div class="limit-item">
                    <label for="confluence-iterations">Confluence Iterations</label>
                    <input type="number" id="confluence-iterations" name="confluenceIterations" value="1" min="1">
                </div>
                <div class="limit-item">
                    <label for="tracker-limit">Tracker Limit</label>
                    <input type="number" id="tracker-limit" name="trackerLimit" value="5" min="1">
                </div>
                <div class="limit-item">
                    <label for="tracker-iterations">Tracker Iterations</label>
                    <input type="number" id="tracker-iterations" name="trackerIterations" value="1" min="1">
                </div>
            </div>

            <div class="form-group">
                <label for="search-orchestrator">Search Orchestrator Type</label>
                <select id="search-orchestrator" name="searchOrchestratorType">
                    <option value="BULK">BULK</option>
                    <option value="ONE_BY_ONE">ONE_BY_ONE</option>
                </select>
            </div>
        </div>

        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-code"></i>
                Source Code Configuration
            </h2>
            
            <div class="source-code-entries" id="source-code-entries">
                <div class="source-code-row">
                    <input type="text" placeholder="Branch Name" name="branchName">
                    <input type="text" placeholder="Repository Name" name="repoName">
                    <input type="text" placeholder="Workspace Name" name="workspaceName">
                    <select name="repoType">
                        <option value="GITHUB">GitHub</option>
                        <option value="BITBUCKET">Bitbucket</option>
                        <option value="GITLAB">GitLab</option>
                    </select>
                    <button type="button" class="remove-button" onclick="removeSourceCodeRow(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <button type="button" class="add-button" onclick="addSourceCodeRow()">
                <i class="fas fa-plus"></i>
                Add Source Configuration
            </button>
        </div>

        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-file-alt"></i>
                Confluence Pages
            </h2>
            
            <div class="confluence-pages" id="confluence-pages">
                <div class="confluence-page-row">
                    <input type="text" placeholder="Enter Confluence page URL" name="confluencePages[]">
                    <button type="button" class="remove-button" onclick="removeConfluencePage(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <button type="button" class="add-button" onclick="addConfluencePage()">
                <i class="fas fa-plus"></i>
                Add Confluence Page
            </button>
        </div>

        <div class="action-buttons">
            <button type="button" class="btn btn-secondary" onclick="window.location.href='/'">
                <i class="fas fa-times"></i>
                Cancel
            </button>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Create Agent
            </button>
        </div>
    </form>
</div>

<script src="css/theme.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Код специфичный для страницы создания агента

        // Обработчики для динамических полей
        const addSourceCodeButton = document.getElementById('add-source-code');
        const sourceCodeEntries = document.getElementById('source-code-entries');
        const addConfluenceButton = document.getElementById('add-confluence');
        const confluencePages = document.getElementById('confluence-pages');
        
        // Добавление нового поля для кода
        addSourceCodeButton.addEventListener('click', function() {
            const newRow = document.createElement('div');
            newRow.className = 'source-code-row';
            newRow.innerHTML = `
                <input type="text" placeholder="Repository URL" required>
                <input type="text" placeholder="Branch" required>
                <input type="text" placeholder="Path" required>
                <select>
                    <option value="md">Markdown (.md)</option>
                    <option value="py">Python (.py)</option>
                    <option value="js">JavaScript (.js)</option>
                    <option value="java">Java (.java)</option>
                    <option value="ts">TypeScript (.ts)</option>
                    <option value="html">HTML (.html)</option>
                    <option value="css">CSS (.css)</option>
                    <option value="json">JSON (.json)</option>
                    <option value="yaml">YAML (.yaml, .yml)</option>
                    <option value="sql">SQL (.sql)</option>
                    <option value="xml">XML (.xml)</option>
                </select>
                <button type="button" class="remove-button">
                    <i class="fas fa-trash-alt"></i>
                </button>
            `;
            sourceCodeEntries.appendChild(newRow);

            // Add event listener to the new remove button
            const removeButton = newRow.querySelector('.remove-button');
            removeButton.addEventListener('click', function() {
                sourceCodeEntries.removeChild(newRow);
            });
        });

        // Добавление нового поля для Confluence
        addConfluenceButton.addEventListener('click', function() {
            const newRow = document.createElement('div');
            newRow.className = 'form-group';
            newRow.innerHTML = `
                <div class="source-code-row">
                    <input type="text" placeholder="Confluence Page URL" required>
                    <button type="button" class="remove-button">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            `;
            confluencePages.appendChild(newRow);

            // Add event listener to the new remove button
            const removeButton = newRow.querySelector('.remove-button');
            removeButton.addEventListener('click', function() {
                confluencePages.removeChild(newRow);
            });
        });

        // Remove initial source code entry
        const initialRemoveButtons = document.querySelectorAll('.remove-button');
        initialRemoveButtons.forEach(button => {
            button.addEventListener('click', function() {
                const row = button.closest('.source-code-row');
                const parent = row.parentNode;
                parent.removeChild(row);
            });
        });

        // Form submission
        document.getElementById('create-agent-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const agentConfig = {
                label: formData.get('label'),
                projectContext: formData.get('projectContext'),
                isCodeAsSource: formData.get('isCodeAsSource') === 'on',
                isConfluenceAsSource: formData.get('isConfluenceAsSource') === 'on',
                isTrackerAsSource: formData.get('isTrackerAsSource') === 'on',
                filesLimit: parseInt(formData.get('filesLimit')),
                filesIterations: parseInt(formData.get('filesIterations')),
                confluenceLimit: parseInt(formData.get('confluenceLimit')),
                confluenceIterations: parseInt(formData.get('confluenceIterations')),
                trackerLimit: parseInt(formData.get('trackerLimit')),
                trackerIterations: parseInt(formData.get('trackerIterations')),
                searchOrchestratorType: formData.get('searchOrchestratorType'),
                source_code_config: [],
                confluencePages: []
            };

            // Collect source code configurations
            const sourceCodeRows = document.querySelectorAll('.source-code-row');
            sourceCodeRows.forEach(row => {
                const config = {
                    branchName: row.querySelector('[name="branchName"]').value,
                    repoName: row.querySelector('[name="repoName"]').value,
                    workspaceName: row.querySelector('[name="workspaceName"]').value,
                    repoType: row.querySelector('[name="repoType"]').value
                };
                agentConfig.source_code_config.push(config);
            });

            // Collect Confluence pages
            const confluenceInputs = document.querySelectorAll('[name="confluencePages[]"]');
            confluenceInputs.forEach(input => {
                if (input.value.trim()) {
                    agentConfig.confluencePages.push(input.value.trim());
                }
            });

            // Here you would typically send the configuration to your backend
            console.log('Agent configuration:', agentConfig);
            
            // For now, just show a success message and redirect
            alert('Agent created successfully!');
            window.location.href = '/';
        });
    });
</script>
</body>
</html> 