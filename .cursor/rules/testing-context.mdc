DMTOOLS QUICK TESTING COMMANDS:

Use these simple commands to quickly test your Java code changes during development.

** QUICK TEST COMMANDS **

Test specific class:
./gradlew test --tests "ClassName"
./gradlew test --tests "com.github.istin.dmtools.ClassName"

Test specific method:
./gradlew test --tests "ClassName.methodName"

Test entire module (fast):
./gradlew :dmtools-core:test
./gradlew :dmtools-server:test

Test with compilation check:
./gradlew compileJava compileTestJava

Quick compile check:
./gradlew classes testClasses

** PROJECT MODULES **
- dmtools-core: Business logic, integrations (no Spring dependencies)
- dmtools-server: Web services, Spring Boot, authentication

** IMPORTANT: DO NOT MODIFY **
- Java version in build.gradle files - configurations work correctly
- Dependencies in build.gradle - most dependencies already exist, only add if specifically required by task

** COMMON TEST FIXES **

Spring Boot configuration missing - add to test class:
@SpringBootTest
@ContextConfiguration(classes = {YourMainApplication.class})

Authentication issues - add to test:
@WithMockUser

Missing Spring beans - add to test class:
@MockBean
private YourService yourService;

Configuration issues - add to test class:
@TestConfiguration
static class TestConfig {
    @Bean @Primary
    YourConfigClass config() { return new YourConfigClass(); }
}

OAuth2 ClientRegistration empty - provide test registration:
ClientRegistration.withRegistrationId("test")
    .clientId("test-client")
    .clientSecret("test-secret")
    .authorizationUri("http://test")
    .tokenUri("http://test")
    .userInfoUri("http://test")
    .build()

Unnecessary Mockito stubbing - use lenient:
@Mock(lenient = true)
or
lenient().when(mockService.method()).thenReturn(value)

Exception testing - verify behavior correctly:
// Test should actually trigger the exception condition
// Check mocks are set up to cause the expected failure path

** QUICK DEBUGGING **
See failure details:
./gradlew test --tests "ClassName" --info

Clean and retry:
./gradlew clean test --tests "ClassName"

** SPRING SECURITY TEST PATTERNS **

OAuth2 testing setup:
@SpringBootTest
@AutoConfigureTestDatabase
@TestPropertySource(properties = {
    "auth.enabled-providers=test",
    "auth.permitted-email-domains=test.com"
})

Security configuration testing:
@WebMvcTest(SecurityConfig.class)
@Import({SecurityConfig.class, AuthConfigProperties.class})

Mock OAuth2 user for testing:
OAuth2User mockUser = mock(OAuth2User.class);
when(mockUser.getAttribute("email")).thenReturn("test@test.com");

Test ClientRegistrationRepository without empty registrations:
// Always provide at least one test registration
List<ClientRegistration> registrations = Arrays.asList(testRegistration);

** COMMON TEST ANTI-PATTERNS TO AVOID **

❌ Empty ClientRegistration list - causes "registrations cannot be empty"
❌ Missing @SpringBootTest when testing Spring components 
❌ Unnecessary mock stubs - clean up unused when() calls
❌ Testing exceptions without proper mock setup to trigger them
❌ Using @WebMvcTest without importing required security configs

** BEFORE COMMIT **
Quick validation:
./gradlew :dmtools-core:test :dmtools-server:test